<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Redirecting to WhatsApp...</title>
  <!-- Fallback to first number if JS disabled -->
  <meta http-equiv="refresh" content="0;url=https://wa.me/918828189978">
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#0b1220;color:#e6eef8;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
    .box{max-width:560px;text-align:center;padding:20px;border-radius:8px;background:rgba(255,255,255,0.02)}
    a{color:#7dd3fc}
    small{color:#94a3b8}
  </style>
</head>
<body>
  <div class="box">
    <h2>Redirecting to WhatsApp...</h2>
    <p id="msg">Please wait â€” opening WhatsApp</p>
    <p style="font-size:13px"><small>If nothing happens automatically, <a id="fallback" href="#">click here</a>.</small></p>
  </div>

  <script>
    // ---------- Configure numbers (international format WITHOUT '+') ----------
    const numbers = [
      "918828189978",
      "918953239074",
      "919204809184",
      "917666065109",
      "919628471260",
      "919112954258",
      "919008564007",
      "919780192314",
      "918885252514"
    ];

    // Public IP endpoint to fetch visitor IP (replace with your own if desired)
    const ipEndpoint = "https://api.ipify.org?format=json";

    // Simple deterministic string hash (djb2)
    function djb2Hash(str) {
      let hash = 5381;
      for (let i = 0; i < str.length; i++) {
        // hash * 33 + c
        hash = ((hash << 5) + hash) + str.charCodeAt(i);
        // Keep in 32-bit integer range
        hash = hash & 0xFFFFFFFF;
      }
      // Ensure non-negative
      return hash >>> 0;
    }

    // Fallback strategy if IP cannot be fetched:
    // 1) Try localStorage-based round-robin (so same browser cycles through numbers)
    // 2) If localStorage unavailable, pick random
    function fallbackChoose() {
      try {
        const key = "wa_redirect_index_v1";
        let idx = parseInt(localStorage.getItem(key) || "0", 10);
        const chosen = numbers[idx % numbers.length];
        localStorage.setItem(key, String((idx + 1) % numbers.length));
        return chosen;
      } catch (e) {
        // Random fallback
        return numbers[Math.floor(Math.random() * numbers.length)];
      }
    }

    // Update message and redirect
    function redirectToNumber(number) {
      const waUrl = "https://wa.me/" + number;
      const msg = document.getElementById("msg");
      const fallback = document.getElementById("fallback");
      // Format display: show with +91 spacing if starts with 91
      let display = "+" + number.replace(/^(\d{2})(\d{5})(\d{5})$/, "$1 $2 $3");
      // If formatting didn't match (other country codes), just add +
      if (!/^\+/.test(display)) display = "+" + number;
      msg.textContent = "Opening WhatsApp chat for: " + display;
      fallback.href = waUrl;
      // Use replace so back button doesn't return to this page
      window.location.replace(waUrl);
    }

    // Main: try fetch IP then deterministically choose index
    (function chooseByIP() {
      // Timeout for fetch (in ms)
      const FETCH_TIMEOUT = 4000; // 4 seconds

      let didRespond = false;

      // Create a race between fetch and timeout
      const timer = setTimeout(() => {
        if (!didRespond) {
          const fb = fallbackChoose();
          redirectToNumber(fb);
          didRespond = true;
        }
      }, FETCH_TIMEOUT);

      // Attempt to fetch public IP
      fetch(ipEndpoint, { method: "GET", cache: "no-cache" })
        .then(resp => {
          if (!resp.ok) throw new Error("IP fetch failed");
          return resp.json();
        })
        .then(data => {
          if (didRespond) return;
          clearTimeout(timer);
          const ip = (data && data.ip) ? String(data.ip) : null;
          if (!ip) {
            // Fallback
            const fb = fallbackChoose();
            redirectToNumber(fb);
            didRespond = true;
            return;
          }
          // Hash the IP deterministically and map to array index
          const h = djb2Hash(ip);
          const idx = h % numbers.length;
          const chosen = numbers[idx];
          redirectToNumber(chosen);
          didRespond = true;
        })
        .catch(() => {
          if (didRespond) return;
          clearTimeout(timer);
          const fb = fallbackChoose();
          redirectToNumber(fb);
          didRespond = true;
        });
    })();
  </script>
</body>
</html>
