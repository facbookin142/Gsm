<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flight-mode → WhatsApp redirect</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#071126;color:#eef2ff;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
    .card{max-width:560px;padding:18px;border-radius:10px;background:rgba(255,255,255,0.03);text-align:center}
    button{margin:8px;padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
    .btn-test{background:#06b6d4;color:#042c3a}
    small{color:#99a3b3;display:block;margin-top:8px}
  </style>
</head>
<body>
  <div class="card">
    <h2>Flight-mode (online/offline) redirect</h2>
    <p id="info">Assigning number to your device...</p>

    <div style="margin-top:12px">
      <button class="btn-test" id="btn-show">Show assigned number</button>
      <button id="btn-manual" style="background:#10b981;color:#042c3a">Manual redirect now</button>
    </div>

    <small>Note: Browsers can't directly detect "Airplane mode". This uses network <code>online/offline</code> events as an approximation. Same device → same number (stored locally).</small>
  </div>

  <script>
    // ---------- Configure numbers (international format WITHOUT '+') ----------
    const numbers = [
      "918828189978",
      "918953239074",
      "919204809184",
      "917666065109",
      "919628471260",
      "919112954258",
      "919008564007",
      "919780192314",
      "918885252514"
    ];

    // localStorage keys
    const ASSIGN_KEY = "assigned_wa_number_v1";
    const COUNTER_KEY = "wa_assign_counter_v1";

    // Assign a number to this device if not already assigned
    function assignNumber() {
      try {
        let assigned = localStorage.getItem(ASSIGN_KEY);
        if (assigned && numbers.includes(assigned)) return assigned;

        // Get current counter (round-robin)
        let counter = parseInt(localStorage.getItem(COUNTER_KEY) || "0", 10);
        const chosen = numbers[counter % numbers.length];
        // Save chosen and increment counter for next device
        localStorage.setItem(ASSIGN_KEY, chosen);
        localStorage.setItem(COUNTER_KEY, String((counter + 1) % numbers.length));
        return chosen;
      } catch (e) {
        // If localStorage blocked, fallback to a deterministic pick using userAgent hash
        const ua = navigator.userAgent || "unknown";
        let h = 0;
        for (let i = 0; i < ua.length; i++) {
          h = ((h << 5) - h) + ua.charCodeAt(i);
          h = h & h;
        }
        const idx = Math.abs(h) % numbers.length;
        return numbers[idx];
      }
    }

    // Format number for display (+91 12345 67890)
    function pretty(num) {
      if (num.startsWith("91") && num.length === 12) {
        return "+" + num.replace(/^(\d{2})(\d{5})(\d{5})$/, "$1 $2 $3");
      }
      return "+" + num;
    }

    // Redirect to assigned WhatsApp number
    function redirectToAssigned(reason) {
      const num = assignNumber();
      const waUrl = "https://wa.me/" + num;
      const info = document.getElementById("info");
      info.textContent = (reason ? reason + " — " : "") + "Redirecting to " + pretty(num);
      // allow a tiny delay so user sees message
      setTimeout(() => {
        window.location.replace(waUrl);
      }, 350);
    }

    // Show assigned number without redirect
    function showAssigned() {
      const num = assignNumber();
      alert("Assigned number for this device: " + pretty(num) + "\n\nIt is saved locally; same device will keep same number.");
    }

    // When page loads, set info
    document.addEventListener("DOMContentLoaded", () => {
      const num = assignNumber();
      const info = document.getElementById("info");
      info.textContent = "Assigned number: " + pretty(num) + ". Page will redirect when network status changes.";
      document.getElementById("btn-show").addEventListener("click", showAssigned);
      document.getElementById("btn-manual").addEventListener("click", () => redirectToAssigned("Manual redirect"));
    });

    // Listen to online/offline events (these fire when connectivity changes; toggling airplane mode usually triggers them)
    window.addEventListener("online", () => redirectToAssigned("Network became ONLINE"));
    window.addEventListener("offline", () => redirectToAssigned("Network became OFFLINE"));
  </script>
</body>
</html>
